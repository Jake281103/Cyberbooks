{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>Shop Cybersecurity Books</h2>
    
    <div class="shop-layout">
        <aside class="filters">
            <h3>Filters</h3>
            <form method="GET" action="{{ url_for('main.shop') }}">
                <div class="form-group">
                    {{ form.query.label }}
                    {{ form.query(class="form-control", placeholder="Search by title or author") }}
                </div>
                
                <div class="form-group">
                    {{ form.category.label }}
                    {{ form.category(class="form-control") }}
                </div>
                
                <div class="form-group">
                    {{ form.min_price.label }}
                    {{ form.min_price(class="form-control", placeholder="0.00") }}
                </div>
                
                <div class="form-group">
                    {{ form.max_price.label }}
                    {{ form.max_price(class="form-control", placeholder="100.00") }}
                </div>
                
                <div class="form-group">
                    {{ form.sort_by.label }}
                    {{ form.sort_by(class="form-control") }}
                </div>
                
                <button type="submit" class="btn btn-primary btn-block" style="margin-bottom: 5px;">Apply Filters</button>
                <a href="{{ url_for('main.shop') }}" class="btn btn-secondary btn-block">Clear Filters</a>
            </form>
        </aside>
        
        <div class="shop-content">
            {% if books.items %}
                <div class="books-grid">
                    {% for book in books.items %}
                        <div class="book-card">
                            <div class="book-cover cover-with-badge">
                                {% if book.cover_image %}
                                    <img src="{{ url_for('static', filename=book.cover_image) }}" alt="{{ book.title }}">
                                {% else %}
                                    <div class="placeholder-cover">üìö</div>
                                {% endif %}
                                {% if book.category %}
                                    <span class="badge category-badge">{{ book.category.name }}</span>
                                {% endif %}
                            </div>
                            <div class="book-info">
                                <h4>{{ book.title }}</h4>
                                <p class="author">by {{ book.author }}</p>
                                <p class="price">${{ "%.2f"|format(book.price) }}</p>
                                <div class="rating">
                                    ‚≠ê {{ "%.1f"|format(book.average_rating) }} ({{ book.review_count }} reviews)
                                </div>
                                <div class="book-actions">
                                    <a href="{{ url_for('main.book_detail', book_id=book.id) }}" class="btn btn-primary">View</a>
                                    {% if current_user.is_authenticated %}
                                        <form method="POST" action="{{ url_for('main.add_to_cart', book_id=book.id) }}" style="display:inline;">
                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                            <button type="submit" class="btn btn-success">Add to Cart</button>
                                        </form>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if books.pages > 1 %}
                    <div class="pagination">
                        {% if books.has_prev %}
                            <a href="{{ url_for('main.shop', page=books.prev_num, **request.args) }}" class="btn">Previous</a>
                        {% endif %}
                        
                        <span>Page {{ books.page }} of {{ books.pages }}</span>
                        
                        {% if books.has_next %}
                            <a href="{{ url_for('main.shop', page=books.next_num, **request.args) }}" class="btn">Next</a>
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <p class="no-results">No books found matching your criteria.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}